<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,minimal-ui">
	<meta name="keywords" content="集利财富，集利网，投资理财，网络理财，个人理财，互联网理财，互联网金融，固定收益，本息保障，个人贷款，网络贷款，网络借贷，小额贷款，信用贷款，担保贷款，网贷平台，投融资平台">
	<meta name="description" content="集利财富：安全可信赖的投资理财平台，为大众用户提供低门槛、可信赖、有保障的投资理财服务！在集利财富，足不出户、轻点鼠标，即可便捷投资、安享收益！">
	<meta name="apple-mobile-web-app-title" content="集利财富，点滴投资，聚集好利，安全可信赖的投资理财平台" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="../css/fontello.css">
	<link rel="stylesheet" href="../css/swiper.min.css">
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/common.css">
	<title>供应链GYL002858－集利财富</title>
	<style>
		.day,.hour,.minute,.second{
				color:#f00;
		}
	</style>
</head>
<body style="margin-bottom:70px;">
	<div class="detail-b ">
    <h3 style="text-align:center">
			<!-- <img src="https://www.51jili.com/attachment/display/3310" > -->
			-----
      <!-- <img src="../image/icon_phone.png" style="width: 60px;height: 40px;margin-right: 0;margin-left: 10px;"> -->
			<!-- <em style="background: url(../image/hot.png) no-repeat;background-size: 100% 100%;"></em> -->
    </h3>
		<div class="detail-b-info">
			<canvas height="300" id="canvas" width="300" data-value="57.68"></canvas>
			<h1>
        进度：<small>--.--%</small>
      </h1>
			<p>预期年化收益率</p>
			<i>--.--%</i>
			<h2>期限<em>--</em>--</h2>
		</div>
	</div>
	<div class="detail-num ">
		<ul class="clearfix">
			<li>
				<p><span>--</span>元</p>
				<p>借款金额</p>
			</li>
			<li>
				<p><span>--</span>元</p>
				<p>可投金额</p>
			</li>
		</ul>
	</div>
	<div class="detail-style">
		<ul>
			<li>
				<div>
					<span>还款方式：</span>
						<em>每期还息到期还本</em>
				</div>
			</li>
			<li>
				<div>
					<span>项目名称：</span>
					<em>支付工程款</em>
				</div>
			</li>
			<li>
				<div>
					<span>预计起息日：</span>
					<em>募集满T+1工作日</em>
				</div>
			</li>
			<li>
				<div>
					<span>剩余募集时间：</span>
					<em>
						<span class="time day">--</span><span>天 </span><span class="time hour">--</span><span>:</span><span class="time minute">--</span><span>:</span><span class="time second">--</span>
					</em>
				</div>
			</li>
      <li>
				<div>
					<span>风险提示：</span>
					<em class="color4">风险提示书<i class="icon-right-open-big"></i></em>
				</div>
			</li>
      <li>
        <div >
          <span>推荐机构：</span>
          <em class="color4 tjjg">----</em>
        </div>
      </li>
		</ul>
	</div>
  <div class="detail-style">
    <ul>
      <li >
        <div>
          <span>项目描述：</span>
					<em class="color1"><i class="icon-right-open-big"></i></em>
        </div>
      </li>
      <li >
        <div>
          <span>借贷方信息：</span>
					<em class="color1"><i class="icon-right-open-big"></i></em>
        </div>
      </li>
      <li >
        <div>
          <span>保障措施：</span>
					<em class="color1"><i class="icon-right-open-big"></i></em>
        </div>
      </li>
      <li >
        <div>
          <span>投标记录：</span>
					<em class="color1"><i class="icon-right-open-big"></i></em>
        </div>
      </li>
      <li >
				<div href="/investment/fy/21">
					<span>相关费用：</span>
					<em class="color4">相关费用<i class="icon-right-open-big"></i></em>
				</div>
			</li>
    </ul>
  </div>
	<script id="investmentDetail_template" type="text/html">
		{{ set d = $data}}
		<div class="detail-b ">
			<h3 style=""><img src="{{d.bt_img}}" >{{d.b_projecttitle}}
				{{if d.canrsecoupon==1}}
				<img src="../image/icon_phone.png" style="width: 60px;height: 40px;margin-right: 0;margin-left: 10px;">
				{{/if}}
				{{if d.b_assignbiddding==1}}
				<img class="yu" src="../image/yu.png">
				{{/if}}
				{{if d.is_hot==1}}
				<em style="background: url(../image/hot.png) no-repeat;background-size: 100% 100%;"></em>
				{{/if}}
			</h3>
			<div class="detail-b-info">
				<canvas height="300" id="canvas" width="300" data-value="{{d.progress.slice(0,-1)}}"></canvas>
				<h1>
					进度：<small>{{d.progress}}</small>
				</h1>
				<p>预期年化收益率</p>
				<i>{{d.Rate}}
					{{if d.IncreasedRate.slice(0,-1)>0}}
            <i style="display: inline-block;color: #ef4646;font-size: 18px;font-style: normal;padding-left: 5px;">+{{d.IncreasedRate}}</i>
					{{/if}}
					{{if d.add_i.slice(0,-1)>0}}
            <i style="display: inline-block;color: #fff;font-size: 14px;font-style: normal;padding:0px 3px;border-radius: 3px;background: #ef4646;line-height: 20px">+{{d.add_i}}</i>
					{{/if}}
        </i>
				{{if d.loandeadline.indexOf('月')}}
				<h2>期限<em>{{d.loandeadline.slice(0,-2)}}</em>个月</h2>
				{{else if d.loandeadline.indexOf('天')}}
				<h2>期限<em>{{d.loandeadline.slice(0,-1)}}</em>天</h2>
				{{/if}}
			</div>
		</div>
		<div class="detail-num ">
			<ul class="clearfix">
				<li>
					<p><span>{{d.b_need_loan}}</span>元</p>
					<p>借款金额</p>
				</li>
				<li>
					<p><span>{{d.b_can_cast_loan}}</span>元</p>
					<p>可投金额</p>
				</li>
			</ul>
		</div>
		<div class="detail-style">
			<ul>
				<li>
					<div>
						<span>还款方式：</span>
							<em>{{d.b_repayment_way}}</em>
					</div>
				</li>
				<li>
					<div>
						<span>项目名称：</span>
						<em>{{d.projectname}}</em>
					</div>
				</li>
				<li>
					<div>
						<span>预计起息日：</span>
						<em>{{d.yuji_qixiri}}</em>
					</div>
				</li>
				{{if d.b_status_name == '立即投标'&&d.b_effective_date}}
				<li class="countdown">
					<div>
						<span>剩余募集时间：</span>
						<em>
							{{@d.b_effective_date|effectiveDateFormat}}
						</em>
					</div>
				</li>
				{{/if}}
				<li>
					<div tapmode onclick="open51Url('{{d.fx_url}}','{{d.fx_tip}}')">
						<span>风险提示：</span>
						<em class="color4">风险提示书<i class="icon-right-open-big"></i></em>
					</div>
				</li>
				{{if d.db_id!=''}}
				<li>
					<div tapmode onclick="jumpToWin('agency','{{d.db_title}}',{db_id:{{d.db_id}} })">
						<span>推荐机构：</span>
						<em class="color4 tjjg">{{d.db_title}}</em>
					</div>
				</li>
				{{/if}}
			</ul>
		</div>
		<div class="detail-style">
			<ul>
				<li tapmode onclick="jumpToWinAfterJudggingLogin('investmentDescription','项目描述',{b_id:{{d.b_id}}})">
					<div>
						<span>项目描述：</span>
						<em class="color1"><i class="icon-right-open-big"></i></em>
					</div>
				</li>
				<li tapmode onclick="jumpToWinAfterJudggingLogin('borrowerInfo','借款人信息',{b_id:{{d.b_id}}})">
					<div>
						<span>借贷方信息：</span>
						<em class="color1"><i class="icon-right-open-big"></i></em>
					</div>
				</li>
				<li tapmode onclick="jumpToWin('safeGuard','保障措施',{b_id:{{d.b_id}}})">
					<div>
						<span>保障措施：</span>
						<em class="color1"><i class="icon-right-open-big"></i></em>
					</div>
				</li>
				<li tapmode onclick="jumpToWinAfterJudggingLogin('bidRecord','购标记录',{b_id:{{d.b_id}}})">
					<div>
						<span>投标记录：</span>
						<em class="color1"><i class="icon-right-open-big"></i></em>
					</div>
				</li>
				<li tapmode onclick="open51Url('investment/fy/21/1','相关费用')">
					<div href="/investment/fy/21">
						<span>相关费用：</span>
						<em class="color4">相关费用<i class="icon-right-open-big"></i></em>
					</div>
				</li>
			</ul>
		</div>
		<div class="footer-btn" style="position:fixed;bottom:0;left:0;width:100%" tapmode >
			<div style="background:#ccc">- - - -</div>
		</div>
	</script>
</body>
<script src="../script/jquery.js"></script>
<script src="../script/common.js"></script>
<script src="../script/indexAnimation.js"></script>
<script src="../script/template-web.js"></script>
<script src="../script/template-filter.js"></script>
<script>
	apiready = function(){
		refreshFrameData()
		refreshHeader()
	}

	function refreshFrameData(){

		var bid = api.pageParam.bid
		refreshData({
			url:'investment_details',
			values:{
				b_id:bid,
				token:''
			},
			fun:function(ret,err){
				console.log(JSON.stringify(ret.data))
				// var json = '{"code":"1","msg":"操作成功","data":{"ac_balances":"0.00","bt_name":"供应链","bt_img":"http://ksh.51jili.com/attachment/display/3310","b_projecttitle":"GYL002886","b_minimum":"100","Rate":"9%","IncreasedRate":"1%","b_interest_rate":"9%","loandeadline":"3个月","b_need_loan":"10,000","b_actual_loan":"1,200","b_can_cast_loan":"8,800.00","b_effective_date":"1510646207","progress":"12.00%","b_status_name":"立即投标","db_id":"13","db_title":"集成金融财富中心","b_repayment_way":"每期还息到期还本","expected_income":"225.00","b_assignbiddding":"1","b_assignpwd":"123456","is_hot":"0","canrsecoupon":"0","add_i":"1%","yuji_qixiri":"募集满T+1工作日","fx_url":"/investment/fx/21/1","fx_tip":"风险提示书","p_qixiri":"募集完毕后下一工作日起息","is_graceperiod":"","ispen_sing":true,"grant":0}}'
				// var data = JSON.parse(json).data;

				var data = ret.data
				data.b_id = bid;

				if(ret.code==1){
					//有预约的话弹窗输入预约码
					if(data.b_assignbiddding==1){
						assignpwdPrompt(data)
					}

					//渲染数据
					var investmentDetailHTML = template('investmentDetail_template' ,data);
					$('body').html(investmentDetailHTML);
					drawCircle()

					// 如果标状态为立即投标，则开启倒计时
					if(data.b_status_name == '立即投标'){
						countdownStart(data.b_effective_date)
					}

					//渲染立即投标按钮
					changeBtn(data)
				}
			}
		},false)
	}

	function countdownStart (timeStamp){
		setInterval(function(){
			var remainTime = timeStamp*1000-Date.parse(new Date())
			var day = numFormat(parseInt(remainTime/1000/60/60/24))
			var hour = numFormat(parseInt((remainTime/1000/60/60)%24))
			var minute = numFormat(parseInt((remainTime/1000/60)%60))
			var second = numFormat((remainTime/1000)%60)
			var countdownHTML = `<span class="time day">${day}</span><span>天 </span>
			<span class="time hour">${hour}</span><span>:</span>
			<span class="time minute">${minute}</span><span>:</span>
			<span class="time second">${second}</span>`

			$('.countdown > div > em').html(countdownHTML)
		},1000)
	}

	function numFormat(num){
		if(num<10){
			return '0'+num
		}else{
			return num
		}
	}

	function assignpwdPrompt(data){
		if(api.systemType=='ios'){
			api.prompt({
				title:'请输入预约码',
				type:'number',
				buttons: ['确定', '取消']
			}, function(ret, err){
			// alert(ret.buttonIndex)
				if(ret.buttonIndex==1){
					if(ret.text.length<6||ret.text.length>8){
						showToastMsg('预约码必须为6-8位纯数字')
						assignpwdPrompt(data)
					}else{
						if(ret.text==data.b_assignpwd){
							showToastMsg('预约码正确')
							// alert('预约码正确进入标详情')
						}else{
							showToastMsg('预约码不正确')
							assignpwdPrompt(data)
						}
					}
				}else if(ret.buttonIndex==2){
					api.closeWin()
				}else if(ret.buttonIndex==0){
					assignpwdPrompt(data)
				}
			});
		}else if(api.systemType=='android'){
			var dialogBox = api.require('dialogBox')
			dialogBox.input({
			    keyboardType: 'number',
			    texts: {
			        title: '请输入预约码',
			        placeholder: '请输入预约码',
			        leftBtnTitle: '取消',
			        rightBtnTitle: '确定'
			    },
			    styles: {
			        bg: '#fff',
			        corner: 2,
			        w: 300,
			        h: 120,
			        title: {
			            h: 20,
			            alignment: 'center',
			            size: 14,
			            color: '#000'
			        },
			        input: {
			            h: 20,
			            marginT: 6,
						marginUD: 6,
			            textSize: 14,
			            textColor: '#000'
			        },
			        dividingLine: {
			            width: 0,
			        },
			        left: {
			            bg: 'rgba(0,0,0,0)',
			            color: '#007FFF',
			            size: 12
			        },
			        right: {
			            bg: 'rgba(0,0,0,0)',
			            color: '#007FFF',
			            size: 12
			        }
			    }
			}, function(ret) {
			    if (ret.eventType == 'left') {
			        var dialogBox = api.require('dialogBox');
			        dialogBox.close({
			            dialogName: 'input'
			        });
					api.closeWin()
			    }else if(ret.eventType == 'right'){
					if(ret.text.length<6||ret.text.length>8){
						alert('预约码必须为6-8位纯数字')
					}else{
						if(ret.text==data.b_assignpwd){
							alertForRetractingKeyboard('预约码输入正确','继续投资')
						}else{
							alert('预约码不正确')
						}
					}
				}
			});
		}
	}

	function changeBtn(data){
		if(data.b_status_name=='立即投标'){
			$('.footer-btn > div').css('background','#ef4646').html(data.b_status_name).on('click',function(){
				// 发送请求检查三个项目（未写）
				// 是否登陆过期
				// 是否实名认证
				// 是否设置交易密码
				// 是否进行风险承受能力评估
				refreshData({
					url:'user_status',
					values:{
						token:''
					},
					fun:function(ret,err){
						console.log(JSON.stringify(ret))
						if(ret.code == 1){
							jumpToWinAfterJudggingLogin('tenderNow','立即投标',{bid:api.pageParam.bid})
						}
					}
				})

			})
			api.parseTapmode();
		}else{
			$('.footer-btn > div').html(data.b_status_name)
		}
	}
</script>
</html>
