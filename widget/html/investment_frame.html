<!DOCTYPE html>
<html lang="en">
<head >
	<meta charset="UTF-8" >
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no,minimal-ui">
	<meta name="keywords" content="集利财富，集利网，投资理财，网络理财，个人理财，互联网理财，互联网金融，固定收益，本息保障，个人贷款，网络贷款，网络借贷，小额贷款，信用贷款，担保贷款，网贷平台，投融资平台">
	<meta name="description" content="集利财富：安全可信赖的投资理财平台，为大众用户提供低门槛、可信赖、有保障的投资理财服务！在集利财富，足不出户、轻点鼠标，即可便捷投资、安享收益！">
	<meta name="apple-mobile-web-app-title" content="集利财富，点滴投资，聚集好利，安全可信赖的投资理财平台" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="../css/fontello.css">
	<link rel="stylesheet" href="../css/swiper.min.css">
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/common.css">
	<title>投标专区－集利财富</title>
</head>
<body>
	<form id="forms1">
		<div class="nav-list-screen">
			<ul class="clearfix">
				<li class="" tapmode onclick="loantimeSort(this)">
					<div class="classifyTitle">
						<span>项目期限</span>
						<i class="icon-down-dir" style="top: 15px;"></i>
						<i class="icon-up-dir" style="top: 8px;"></i>
					</div>
				</li>
				<li class="" tapmode onclick="rateSort(this)">
					<div class="classifyTitle">
						<span>年化利率</span>
						<i class="icon-down-dir" style="top: 15px;"></i>
						<i class="icon-up-dir" style="top: 8px;"></i>
					</div>
				</li>
				<li class="">
					<div class="classifyTitle filter" tapmode onclick="openSlidFrame()">
						<span>筛选</span>
						<i class="icon-th-thumb-empty"></i>
					</div>
				</li>
			</ul>
		</div>
	</form>
	<div class="main">
		<div class="nav-content">
			<div class="target_tou">
				<ul>
					<script id="toubiao_template" type="text/html">
						{{ set b = $data}}
						{{each b value key}}
						<li class="
						{{if value.b_status_name=='投标中'}}
						{{else if value.b_status_name=='已过期'}}
							pass
						{{else if value.b_status_name=='已售罄'}}
							repayment_su
						{{else if value.b_status_name=='还款中'}}
							repayment_in
						{{else if value.b_status_name=='已结束'}}
							pass
						{{/if}}
						{{if value.is_hot==1}}
							hot
						{{/if}}
						" tapmode onclick="jumpToWin('investmentDetail','项目详情',{bid:{{value.b_id}}})">
							<div class="target_tou_t">
								<h1><img src="{{value.bt_img}}">{{value.b_projecttitle}}
									{{if value.canrsecoupon==1}}
										<img src="../image/icon_phone.png" style="width: 60px;height: 40px;margin-right: 0;margin-left: 10px;">
									{{/if}}
									{{if value.b_assignbiddding==1}}
										<img class="yu" src="../image/yu.png" >
									{{/if}}
					            </h1>
								<span class="target_tou_s"><i data-val="{{value.progress | rateFormat}}" style="width:{{value.progress}}"></i></span>
							</div>
							<div class="target_tou_b clearfix">
								<dl style="width: 40%;">
									<dt class="color3 fs14" >
										<em class="color-red fs24">{{value.Rate.slice(0,-1)}}</em>
										<i class="color-red fs16">%</i>
										{{if value.IncreasedRate.slice(0,-1) >0}}
										+<em class="color-red fs24">{{value.IncreasedRate.slice(0,-1)}}</em><i class="color-red fs16">%</i>
										{{/if}}

										{{if value.add_i.slice(0,-1) >0}}
										<i style="display: inline-block;margin-left: 5px;color: #fff;font-size: 14px;font-style: normal;padding:0px 3px;border-radius: 3px;background: #ef4646;line-height: 20px">
											+{{value.add_i.slice(0,-1)}}%
										</i>
										{{/if}}
	                				</dt>
									<dd>预期年化收益率</dd>
								</dl>
								<dl style="width: 24%;">
									<dt class="color4 fs16">
										{{@value.loandeadline|loandeadlineFormat}}
									</dt>
									<dd>项目期限</dd>
								</dl>
								<dl style="width: 36%;">
									<dt><em class="color2 fs20">{{value.b_need_loan}}</em></dt>
									<dd>投标金额（元）</dd>
								</dl>
							</div>
							<div class="toubiao-btn">{{value.b_status_name}}</div>
						</li>
						{{/each}}
					</script>

          <!-- <li class="" tapmode onclick="jumpToDetail()">
						<div class="target_tou_t">
							<h1><img src="https://www.51jili.com/attachment/display/3310">GYL002858                                                                                                                            <img src="../image/icon_phone.png" style="width: 60px;height: 40px;margin-right: 0;margin-left: 10px;">
                                                                                                                                                                                </h1>
							<span class="target_tou_s">
								<i data-val="25.98" style="width:30%"></i>
							</span>
						</div>
						<div class="target_tou_b clearfix">
							<dl style="width: 40%;">
								<dt class="color3 fs14" ><em class="color-red fs24">8.8</em><i class="color-red fs16">%</i>
                                                                                                                                                                                                        </dt>
								<dd>预期年化收益率</dd>
							</dl>
							<dl style="width: 24%;">
								<dt class="color4 fs16"><em class="fs20">6</em><i>个月</i></dt>
								<dd>项目期限</dd>
							</dl>
							<dl style="width: 36%;">
								<dt><em class="color2 fs20">400,000</em></dt>
								<dd>投标金额（元）</dd>
							</dl>
						</div>
						<div class="toubiao-btn">立即投标</div>
					</li> -->
        		</ul>
				<div class="tou-list-tip" style="text-align: center;padding: 10px;font-size: 16px;color: #999;">
				下拉加载更多
					<i class="icon-angle-double-down"></i>
				</div>
			</div>

</body>
<script src="../script/jquery.js"></script>
<script src="../script/common.js"></script>
<script src="../script/template-web.js"></script>
<script src="../script/template-filter.js"></script>
<script>
	// 声明  期限，利率，项目变量
	var offsetData = 0,
		pubtimeData = null,
		rateData = null,
		bt_codeData = null,
		loantime_sort = null,
		rate_sort = null


	apiready = function (){
		refreshHeader()
		refreshFrameData()
		bottomRefresh()
		// 监听更新分类数据时间
		api.addEventListener({
		    name: 'refreshInvestmentClassifyData'
		}, function(ret, err){
			// 接受数据
			pubtimeData = ret.value.pubtimeData
			rateData = ret.value.rateData
			bt_codeData = ret.value.bt_codeData
			offsetData = 0
			// 重置分类设置
			loantime_sort = null
			rate_sort = null
			resetOrderStyle()
			//刷新数据
			refreshClassifyData()
		});
		//回到顶部按钮
		var button = api.require('UIButton');
		button.open({
	    rect: {
	        x: api.frameWidth*0.8,
	        y: api.frameHeight*0.8,
	        w: 80,
	        h: 50
	    },
	    corner: 5,
	    bg: {
	        normal: '#ef4646',
	        highlight: '#ffd6d6',
	        active: '#ffd6d6'
	    },
	    title: {
	        size: 14,
	        highlight: '回到顶部',
	        active: '回到顶部',
	        normal: '回到顶部',
	        highlightColor: '#000',
	        activeColor: '#000',
	        normalColor: '#fff',
	        alignment: 'center'
	    },
	    fixedOn: api.frameName,
	    fixed: true,
	    move: true
		}, function(ret, err) {
			api.pageUp({
				top:true
			});
			var id = ret.id
			button.setState({
				id: id,
				state: 'normal'
			});
		});
	}

	// 打开侧边栏
	function openSlidFrame (){
		api.openFrame({
		    name: 'investmentClassify',
		    url: './investmentClassify.html',
			animation:{
				type:'fade',
				subType:'from_right'
			},
			bgColor:'rgba(0,0,0,0.5)',
			rect:{
				x:0,
				y:0,
				w:'auto',
				h:'auto',
			},
			pageParam:{
				pubtime : pubtimeData,
				rate : rateData,
				bt_code : bt_codeData
			}
		});
	}

	function refreshFrameData(){
		resetOrderStyle()
		refreshData({
			url:"investment",
			values:{
				limit:10,
				offset:0
			},
			fun:function(ret,err){
				if(ret.code == 1){
					// 重置全局变量
					offset = 0
					pubtimeData = null
					rateData = null
					bt_codeData = null
					loantime_sort = null
					rate_sort = null

					// var json = '{"code":"1","msg":"操作成功","data":[{"b_id":"2886","bt_name":"供应链","bt_img":"http://ksh.51jili.com/attachment/display/3310","b_projecttitle":"GYL002886","Rate":"9%","IncreasedRate":"1%","b_interest_rate":"9%","b_need_loan":"10,000.00","b_actual_loan":"1,100.00","b_can_cast_loan":"8,900.00","progress":"11.00%","loandeadline":"90天","b_status_name":"投标中","is_hot":"1","canrsecoupon":"1","b_assignbiddding":"0","add_i":"1%"},{"b_id":"2867","bt_name":"担保通","bt_img":"http://ksh.51jili.com/attachment/display/3316","b_projecttitle":"DBT002867","Rate":"8%","IncreasedRate":"0%","b_interest_rate":"8%","b_need_loan":"3,000.00","b_actual_loan":"100.00","b_can_cast_loan":"2,900.00","progress":"3.33%","loandeadline":"180天","b_status_name":"投标中","is_hot":"0","canrsecoupon":"0","b_assignbiddding":"0","add_i":"0%"},{"b_id":"2860","bt_name":"彩虹盛柘","bt_img":"http://ksh.51jili.com/attachment/display/3312","b_projecttitle":"CH002860","Rate":"8%","IncreasedRate":"0%","b_interest_rate":"8%","b_need_loan":"550,000.00","b_actual_loan":"100,000.00","b_can_cast_loan":"450,000.00","progress":"18.18%","loandeadline":"90天","b_status_name":"已过期","is_hot":"0","canrsecoupon":"0","b_assignbiddding":"0","add_i":"0%"}]}'
					// var data = JSON.parse(json).data;
					var data = ret.data
					//渲染投标专区数据
					var toubiaoHTML = template('toubiao_template',data);
					$('.target_tou > ul').html(toubiaoHTML);
					api.parseTapmode();
					$('.tou-list-tip').html('下拉加载更多<i class="icon-angle-double-down"></i>')
				}
			}
		})
	}

	// 刷新分类数据信息
	function refreshClassifyData(isBottomRefresh){
		refreshData({
			url:"investment",
			values:{
				limit:10,
				offset:offsetData,
				bt_code:bt_codeData,
				pubtime:pubtimeData,
				rate:rateData,
				loantime_sort:loantime_sort,
				rate_sort:rate_sort
			},
			fun:function(ret,err){
				if(ret.code == 1){
					var data = ret.data
					if(!isBottomRefresh){
						// 全部刷新时
						// 重置全局offset
						offsetData = 0
						if(data!=null){
							//渲染投标专区数据
							var toubiaoHTML = template('toubiao_template',data);
							$('.target_tou > ul').html(toubiaoHTML);
							api.parseTapmode();
							$('.tou-list-tip').html('下拉加载更多<i class="icon-angle-double-down"></i>')

						}else{
							showToastMsg('亲，无符合条件的项目哟~~')
						}
					}else{
						// 上拉刷新时
						if(data!=null){
							//上拉刷新添加数据
							var toubiaoHTML = template('toubiao_template',data);
							$('.target_tou > ul').append(toubiaoHTML);
							api.parseTapmode();
						}else{
							showToastMsg('亲，已经到底部了~~')
							$('.tou-list-tip').html('亲，已经到底部了~~')
						}
					}
				}
			}
		})
	}

	// 底部上拉刷新事件
	function bottomRefresh(){
		api.addEventListener({
		    name: 'scrolltobottom',
				extra:{
					threshold:100
				}
		}, function(ret, err){
			//页数加1，然后刷新分类数据
			offsetData++
			refreshClassifyData(true)
		});
	}

	//升降序排序按钮切换
	function orderChange (tag){
		var _this = $(tag)
		_this.prev().removeClass('desc asc')
		_this.next().removeClass('desc asc')
		if(_this.hasClass('asc')){
			_this.removeClass('asc').addClass('desc')
		}else if(_this.hasClass('desc')){
			_this.removeClass('desc').addClass('asc')
		}else{
			_this.addClass('desc')
		}
	}

	// 年化利率排序
	function rateSort(tag){
		orderChange(tag)
		loantime_sort = null
		offsetData = 0
		if(rate_sort == null){
			rate_sort = 'desc'
			refreshClassifyData()
		}else if(rate_sort == 'desc'){
			rate_sort = 'asc'
			refreshClassifyData()
		}else if(rate_sort == 'asc'){
			rate_sort = 'desc'
			refreshClassifyData()
		}
	}

	// 年化利率排序
	function loantimeSort(tag){
		orderChange(tag)
		rate_sort = null
		offsetData = 0
		if(loantime_sort == null){
			loantime_sort = 'desc'
			refreshClassifyData()
		}else if(loantime_sort == 'desc'){
			loantime_sort = 'asc'
			refreshClassifyData()
		}else if(loantime_sort == 'asc'){
			loantime_sort = 'desc'
			refreshClassifyData()
		}
	}

	//重置排序样式
	function resetOrderStyle(){
		$('.nav-list-screen li').removeClass('desc asc')
	}
</script>
</html>
