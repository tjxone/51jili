<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,minimal-ui">
	<meta name="keywords" content="集利财富，集利网，投资理财，网络理财，个人理财，互联网理财，互联网金融，固定收益，本息保障，个人贷款，网络贷款，网络借贷，小额贷款，信用贷款，担保贷款，网贷平台，投融资平台">
	<meta name="description" content="集利财富：安全可信赖的投资理财平台，为大众用户提供低门槛、可信赖、有保障的投资理财服务！在集利财富，足不出户、轻点鼠标，即可便捷投资、安享收益！">
	<meta name="apple-mobile-web-app-title" content="集利财富，点滴投资，聚集好利，安全可信赖的投资理财平台" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="stylesheet" href="../css/fontello.css">
	<link rel="stylesheet" href="../css/swiper.min.css">
	<link rel="stylesheet" href="../css/bootstrap.min.css">
	<link rel="stylesheet" href="../css/common.css">
	<style>
		body{
			background:rgba(0,0,0,0);
		}
		.left{
			flex-grow:1;
			min-width:20%;
		}
		.right{
			flex-grow:4;
			padding:10px;
			background-color: #fff;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			height: 100%;
		}
		.right h3{
			color:#999;
			font-size:16px;
		}
		.right > ul ul li{
			float:left;
			width:45%;
			padding:2%;
			margin:2%;
			text-align:center;
			border:1px solid #999;
			border-radius:5px;
		}
		.rightBox ul li.active{
			border-color:#F08686;
			color:#ea4646;
			background-color: #FFE5E5;
		}
		.rightBoxBtn > ul{
			display: flex;
			justify-content: space-around;;
		}
		.rightBoxBtn > li{

		}
	</style>
	<title>侧边栏</title>
</head>
<body tapmode>

	<div class="slidBox" style="display:flex;justify-content:flex-end">
		<div class="left" tapmode onclick="closeFrames()"></div>
		<div class="right">
				<ul class="rightBox">
					<script id="investCondition_template" type="text/html">
							{{set d = $data}}
							{{each d classes key}}
							<li class="{{key}}">
								<h3>{{key | classifyFormat}}</h3>
								<ul class="clearfix">
									{{if key=='pubtime'|key=='rate'}}
										<li tapmode onclick="changeStatus(this)" data-id=' '>全部</li>
										{{each classes v k }}
										<li tapmode onclick="changeStatus(this)" data-id={{v.id}}>{{v.name}}</li>
										{{/each}}
									{{else if key=='bdtype'}}
										<li tapmode onclick="changeStatus(this)" data-btCode=' '>全部</li>
										{{each classes v k }}
										<li tapmode onclick="changeStatus(this)" data-btCode={{v.bt_code}}>{{v.bt_name}}</li>
										{{/each}}
									{{/if}}
								</ul>
							</li>
							{{/each}}
					</script>
					<li>
						<h3>期限</h3>
						<ul class="clearfix">
							<li tapmode onclick="changeStatus(this)">15-29天</li>
							<li tapmode onclick="changeStatus(this)">15-29天</li>
							<li tapmode onclick="changeStatus(this)">15-29天</li>
							<li tapmode onclick="changeStatus(this)">15-29天</li>
						</ul>
					</li>
				</ul>
				<div class="rightBoxBtn clearfix">
					<ul>
						<li tapmode class="classifyReset">重置</li>
						<li tapmode class="classifyOk">确认</li>
					</ul>
				</div>
		</div>
	</div>
</body>
<script src="../script/jquery.js"></script>
<script src="../script/common.js"></script>
<script src="../script/template-web.js"></script>
<script src="../script/template-filter.js"></script>
<script>
apiready = function(){
		refreshFrameData()
}
window.onload = function(){
	//加载后确定高度
	$('.slidBox').height(screen.height)
	//重置按键
	$('.classifyReset').click(function(){
		$('.rightBox').find('li').removeClass('active')
	})
	//确定按键
	$('.classifyOk').click(function(){
		//请选择至少一个选项
		var activeNumber = $('.rightBox .active').length;
		if(activeNumber >= 1){
				var pubtimeData = $('.pubtime').find('li.active').attr('data-id')
				var rateData = $('.rate').find('li.active').attr('data-id')
				var bt_codeData = $('.bdtype').find('li.active').attr('data-btCode')
				alert('期限'+pubtimeData+'利率'+rateData+'项目'+bt_codeData)
				//指定investment_frame更新渲染数据
				api.sendEvent({
				    name: 'refreshClassifyData',
				    extra: {
				        pubtimeData : pubtimeData != undefined ? pubtimeData : ' ',
				        rateData : rateData != undefined ? rateData : ' ',
								bt_codeData : bt_codeData != undefined ? bt_codeData : ' ',
								offset : 0
				    }
				});

				// api.execScript({
				//     name: 'index',
				//     frameName: 'investment',
				//     script: 'refreshClassifyData("'+pubtimeData+'","'+rateData+'","'+bt_codeData+'",0)'
				// 		// script: 'refreshClassifyData(" "," "," ")'
				// });
				closeFrames();
		}else{
				showToastMsg('亲，请至少选择一个选项哟~~')
		}
	})
}

//改变选项状态
function changeStatus(el){
		if($(el).hasClass('active')){
			$(el).removeClass('active')
		}else{
			$(el).parent().find('li').removeClass('active')
			$(el).addClass('active')
		}
}

//关闭frame组
function closeFrames(){
	api.closeFrame({
		name:'investmentClassify'
	})
	api.closeFrame()
}


function refreshFrameData(){
	refreshData({
		url:'investment_condition',
		fun:function(ret,err){
			console.log(JSON.stringify(ret));
			if(ret.code == 1){
				var data = ret.data;
				investConditionHTML = template('investCondition_template',data);
				$('.rightBox').html(investConditionHTML);
			}
		}
	})
}
</script>

</html>
